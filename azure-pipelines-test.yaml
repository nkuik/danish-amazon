trigger:
  branches:
    include:
    - '*'

pr:
  branches:
    include:
    - '*'

pool:
  vmImage: 'ubuntu-latest'

variables:
- group: 'test-build-release'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.7'
  displayName: 'Use Python 3.7'

- script: |
    python -m pip install --upgrade pip
    pip install pipenv
  displayName: 'Install pipenv'

- script: |
    pipenv install --dev
  displayName: 'Install dependencies using pipenv'
  workingDirectory: $(Build.Repository.LocalPath)

- script: |
    pipenv run pytest --cov=. tests/
  displayName: 'Run tests'

- script: |
    bash <(curl -s https://codecov.io/bash)
  displayName: 'Upload to codecov.io'
  env:
    CODECOV_TOKEN: $(slack_client_codecov_token)
